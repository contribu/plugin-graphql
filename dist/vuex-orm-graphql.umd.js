!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.vuexOrmGraphql=n()}(this,function(){"use strict";var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};function n(n,t){function o(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var t=function(){return(t=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function o(e,n,t,o){return new(t||(t=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){e.done?r(e.value):new t(function(n){n(e.value)}).then(s,a)}u((o=o.apply(e,n||[])).next())})}function r(e,n){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var i,s=(function(e,n){var t;t=function(){var e=[],n=[],t={},o={},r={};function i(e){return"string"==typeof e?new RegExp("^"+e+"$","i"):e}function s(e,n){return e===n?n:e===e.toUpperCase()?n.toUpperCase():e[0]===e[0].toUpperCase()?n.charAt(0).toUpperCase()+n.substr(1).toLowerCase():n.toLowerCase()}function a(e,n){return e.replace(n[0],function(t,o){var r,i,a=(r=n[1],i=arguments,r.replace(/\$(\d{1,2})/g,function(e,n){return i[n]||""}));return s(""===t?e[o-1]:t,a)})}function u(e,n,o){if(!e.length||t.hasOwnProperty(e))return n;for(var r=o.length;r--;){var i=o[r];if(i[0].test(n))return a(n,i)}return n}function c(e,n,t){return function(o){var r=o.toLowerCase();return n.hasOwnProperty(r)?s(o,r):e.hasOwnProperty(r)?s(o,e[r]):u(r,o,t)}}function l(e,n,t,o){return function(o){var r=o.toLowerCase();return!!n.hasOwnProperty(r)||!e.hasOwnProperty(r)&&u(r,r,t)===r}}function d(e,n,t){var o=1===n?d.singular(e):d.plural(e);return(t?n+" ":"")+o}return d.plural=c(r,o,e),d.isPlural=l(r,o,e),d.singular=c(o,r,n),d.isSingular=l(o,r,n),d.addPluralRule=function(n,t){e.push([i(n),t])},d.addSingularRule=function(e,t){n.push([i(e),t])},d.addUncountableRule=function(e){"string"!=typeof e?(d.addPluralRule(e,"$0"),d.addSingularRule(e,"$0")):t[e.toLowerCase()]=!0},d.addIrregularRule=function(e,n){n=n.toLowerCase(),e=e.toLowerCase(),r[e]=n,o[n]=e},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["whiskey","whiskies"]].forEach(function(e){return d.addIrregularRule(e[0],e[1])}),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|tlas|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[emjzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/(m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach(function(e){return d.addPluralRule(e[0],e[1])}),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/(m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|tlas|gas|(?:her|at|gr)o|ris)(?:es)?$/i,"$1"],[/(analy|ba|diagno|parenthe|progno|synop|the|empha|cri)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(e){return d.addSingularRule(e[0],e[1])}),["adulthood","advice","agenda","aid","alcohol","ammo","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","flounder","fun","gallows","garbage","graffiti","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","manga","news","pike","plankton","pliers","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","species","staff","swine","tennis","traffic","transporation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(d.addUncountableRule),d},e.exports=t()}(i={exports:{}},i.exports),i.exports),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=s.plural,c=s.singular;function l(e){return e.charAt(0).toUpperCase()+e.slice(1)}function d(e){return e.charAt(0).toLowerCase()+e.slice(1)}function h(e){return e}function f(e){return e}function p(e){return e}function m(e){return null!==e&&"object"===(void 0===e?"undefined":a(e))}var g=function(){function e(e){this.PREFIX=["%c Vuex-ORM: GraphQL Plugin %c","background: #35495e; padding: 1px 0; border-radius: 3px; color: #eee;","background: transparent;"],this.enabled=e,this.log("Logging is enabled.")}return e.prototype.group=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(console.groupCollapsed?console.groupCollapsed.apply(console,this.PREFIX.concat(e)):console.log.apply(console,this.PREFIX.concat(e)))},e.prototype.groupEnd=function(){this.enabled&&console.groupEnd&&console.groupEnd()},e.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&console.log.apply(console,this.PREFIX.concat(e))},e.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&console.warn.apply(console,this.PREFIX.concat(e))},e.prototype.logQuery=function(e,n,t){if(this.enabled)try{var o=h(e);this.group("Sending query:",o.split("\n")[1].replace("{","").trim()),console.log(o),n&&console.log("VARIABLES:",n),t&&console.log("FETCH POLICY:",t),this.groupEnd()}catch(n){console.error("[Vuex-ORM-Apollo] There is a syntax error in the query!",n,e)}},e}(),y=function(){function e(e){var n=this;this.fields=new Map,this.mocks={},this.baseModel=e,this.singularName=c(this.baseModel.entity),this.pluralName=u(this.baseModel.entity);var t=this.baseModel.fields();Object.keys(t).forEach(function(e){n.fields.set(e,t[e])})}return e.isFieldNumber=function(e){if(!e)return!1;var n=$.getInstance();return e instanceof n.components.Number||e instanceof n.components.Increment},e.isFieldAttribute=function(e){var n=$.getInstance();return e instanceof n.components.Increment||e instanceof n.components.Attr||e instanceof n.components.String||e instanceof n.components.Number||e instanceof n.components.Boolean},e.isConnection=function(e){var n=$.getInstance();return!(e instanceof n.components.BelongsTo||e instanceof n.components.HasOne||e instanceof n.components.MorphTo||e instanceof n.components.MorphOne)},e.augment=function(e){var n=e.baseModel.fields.bind(e.baseModel);e.baseModel.fields=function(){var t=n();return t.$isPersisted=e.baseModel.boolean(!1),t}},e.prototype.getQueryFields=function(){var n=this,t=[];return this.fields.forEach(function(o,r){e.isFieldAttribute(o)&&!n.skipField(r)&&t.push(r)}),t},e.prototype.skipField=function(e){if(e.startsWith("$"))return!0;if(this.baseModel.skipFields&&this.baseModel.skipFields.indexOf(e)>=0)return!0;var n=$.getInstance(),t=!1;return this.getRelations().forEach(function(o){return!(o instanceof n.components.BelongsTo||o instanceof n.components.HasOne)||o.foreignKey!==e||(t=!0,!1)}),t},e.prototype.getRelations=function(){var n=new Map;return this.fields.forEach(function(t,o){e.isFieldAttribute(t)||n.set(o,t)}),n},e.prototype.isTypeFieldOfPolymorphicRelation=function(e){var n=this,t=$.getInstance(),o=!1;return t.models.forEach(function(r){return!o&&(r.getRelations().forEach(function(r){return!(r instanceof t.components.MorphMany||r instanceof t.components.MorphedByMany||r instanceof t.components.MorphOne||r instanceof t.components.MorphTo||r instanceof t.components.MorphToMany)||r.type!==e||!r.related||r.related.entity!==n.baseModel.entity||(o=!0,!1)}),!0)}),o},e.prototype.getRecordWithId=function(e){return this.baseModel.query().withAllRecursive().where("id",e).first()},e.prototype.shouldEagerLoadRelation=function(e,n,t){var o=$.getInstance();return n instanceof o.components.HasOne||n instanceof o.components.BelongsTo||n instanceof o.components.MorphOne||void 0!==(this.baseModel.eagerLoad||[]).find(function(n){return n===t.singularName||n===t.pluralName||n===e})},e}(),v=function(){function e(){}return e.transformOutgoingData=function(e,n,t){var o=this,r=$.getInstance(),i=e.getRelations(),s={};return Object.keys(n).forEach(function(u){var l=n[u];if(t&&t.includes(u)||(!i.has(u)||i.get(u)instanceof r.components.BelongsTo)&&!u.startsWith("$")&&null!==l&&void 0!==l){var d=i.get(u)&&i.get(u).parent?r.getModel(c(i.get(u).parent.entity),!0):null;if(l instanceof Array){var h=r.getModel(c(u),!0);s[u]=h?l.map(function(n){return o.transformOutgoingData(h||e,n)}):l}else"object"===(void 0===l?"undefined":a(l))&&void 0!==l.$id?(d||(d=r.getModel(l.$self().entity)),s[u]=o.transformOutgoingData(d,l)):s[u]=l}}),s},e.transformIncomingData=function(e,n,o,r){var i=this;void 0===o&&(o=!1),void 0===r&&(r=!1);var s={},a=$.getInstance();return r||(a.logger.group("Transforming incoming data"),a.logger.log("Raw data:",e)),Array.isArray(e)?s=e.map(function(e){return i.transformIncomingData(e,n,o,!0)}):Object.keys(e).forEach(function(t){if(t in e)if(m(e[t])){var c=a.getModel(t,!0)||n;if(e[t].nodes&&"nodes"===a.connectionQueryMode)s[u(t)]=i.transformIncomingData(e[t].nodes,c,o,!0);else if(e[t].edges&&"edges"===a.connectionQueryMode)s[u(t)]=i.transformIncomingData(e[t].edges,c,o,!0);else if(e.node&&"edges"===a.connectionQueryMode)s=i.transformIncomingData(e.node,c,o,!0);else{var l=t;o&&!r&&(l=d(l=e[t].nodes?c.pluralName:c.singularName)),s[l]=i.transformIncomingData(e[t],c,o,!0)}}else y.isFieldNumber(n.fields.get(t))?s[t]=parseFloat(e[t]):t.endsWith("Type")&&n.isTypeFieldOfPolymorphicRelation(t)?s[t]=u(d(e[t])):s[t]=e[t]}),r?s.$isPersisted=!0:(a.logger.log("Transformed data:",s),a.logger.groupEnd()),t({},s)},e}(),b=function(){function e(){var e=$.getInstance();this.apolloClient=e.options.apolloClient,this.apolloClient.prettify=h}return e.prototype.request=function(n,t,i,s,a){return void 0===s&&(s=!1),void 0===a&&(a=!1),o(this,void 0,void 0,function(){var o,u,c;return r(this,function(r){switch(r.label){case 0:return o=a?"network-only":"cache-first",$.getInstance().logger.logQuery(t,i,o),u={headers:e.getHeaders()},s?[4,this.apolloClient.mutate({mutation:t,variables:i,context:u})]:[3,2];case 1:return c=r.sent(),[3,4];case 2:return[4,this.apolloClient.query({query:t,variables:i,fetchPolicy:o,context:u})];case 3:c=r.sent(),r.label=4;case 4:return[2,v.transformIncomingData(c.data,n,s)]}})})},e.prototype.simpleQuery=function(n,t,i,s){return void 0===i&&(i=!1),o(this,void 0,void 0,function(){var o;return r(this,function(r){return o=i?"network-only":"cache-first",[2,this.apolloClient.query({query:n,variables:t,fetchPolicy:o,context:{headers:e.getHeaders()}})]})})},e.prototype.simpleMutation=function(n,t,i){return o(this,void 0,void 0,function(){return r(this,function(o){return[2,this.apolloClient.mutate({mutation:n,variables:t,context:{headers:e.getHeaders()}})]})})},e.getHeaders=function(){var e=$.getInstance(),n=e.options.headers?e.options.headers:{};return"function"==typeof n&&(n=n(e)),n},e}(),w=function(){function e(e){var n=this;this.schema=e,this.types=new Map,this.mutations=new Map,this.queries=new Map,this.schema.types.forEach(function(e){return n.types.set(e.name,e)}),this.getType("Query").fields.forEach(function(e){return n.queries.set(e.name,e)}),this.getType("Mutation").fields.forEach(function(e){return n.mutations.set(e.name,e)})}return e.prototype.determineQueryMode=function(){var n=this,t=null;if(this.queries.forEach(function(o){var r=e.getTypeNameOfField(o);return!r.endsWith("TypeConnection")||(t=n.getType(r),!1)}),!t)throw new Error("Can't determine the connection mode due to the fact that here are no connection types in the schema. Please set the connectionQueryMode via Vuex-ORM-GraphQL options!");return t.fields.find(function(e){return"nodes"===e.name})?"nodes":t.fields.find(function(e){return"edges"===e.name})?"edges":"plain"},e.prototype.getType=function(e,n){void 0===n&&(n=!1),e=l(e);var t=this.types.get(e);if(!n&&!t)throw new Error("Couldn't find Type of name "+e+" in the GraphQL Schema.");return t||null},e.prototype.getMutation=function(e,n){void 0===n&&(n=!1);var t=this.mutations.get(e);if(!n&&!t)throw new Error("Couldn't find Mutation of name "+e+" in the GraphQL Schema.");return t||null},e.prototype.getQuery=function(e,n){void 0===n&&(n=!1);var t=this.queries.get(e);if(!n&&!t)throw new Error("Couldn't find Query of name "+e+" in the GraphQL Schema.");return t||null},e.returnsConnection=function(n){return e.getTypeNameOfField(n).endsWith("TypeConnection")},e.getRealType=function(e){return"NON_NULL"===e.kind?this.getRealType(e.ofType):e},e.getTypeNameOfField=function(e){var n=this.getRealType(e.type);if("LIST"===n.kind)return"["+n.ofType.name+"]";var t=n.name||n.ofType.name||n.ofType.ofType.name;if(!t)throw new Error("Can't find type name for field "+e.name);return t},e}(),$=function(){function e(e,n){if(this.models=new Map,this.debugMode=!1,this.connectionQueryMode="auto",this.globalMocks={},this.components=e,this.options=n,this.database=n.database,this.debugMode=Boolean(n.debug),this.logger=new g(this.debugMode),!n.database)throw new Error("database param is required to initialize vuex-orm-graphql!")}return e.getInstance=function(){return this.instance},e.setup=function(n,t){return this.instance=new e(n,t),this.instance.apollo=new b,this.instance.collectModels(),this.instance.logger.group("Context setup"),this.instance.logger.log("components",this.instance.components),this.instance.logger.log("options",this.instance.options),this.instance.logger.log("database",this.instance.database),this.instance.logger.log("models",this.instance.models),this.instance.logger.groupEnd(),this.instance},e.prototype.loadSchema=function(){return o(this,void 0,void 0,function(){var e=this;return r(this,function(n){return this.schemaWillBeLoaded||(this.schemaWillBeLoaded=new Promise(function(n,t){return o(e,void 0,void 0,function(){var e,t;return r(this,function(o){switch(o.label){case 0:return this.logger.log("Fetching GraphQL Schema initially ..."),this.options.connectionQueryMode?this.connectionQueryMode=this.options.connectionQueryMode:this.connectionQueryMode="auto",e={headers:{"X-GraphQL-Introspection-Query":"true"}},[4,this.apollo.simpleQuery("\nquery Introspection {\n  __schema {\n    types {\n      name\n      fields(includeDeprecated: true) {\n        name\n        args {\n          name\n          type {\n            name\n            kind\n\n            ofType {\n              kind\n\n              name\n              ofType {\n                kind\n                name\n\n                ofType {\n                  kind\n                  name\n                }\n              }\n            }\n          }\n        }\n\n        type {\n          name\n          kind\n\n          ofType {\n            kind\n\n            name\n            ofType {\n              kind\n              name\n\n              ofType {\n                kind\n                name\n              }\n            }\n          }\n        }\n      }\n\n      inputFields {\n        name\n        type {\n          name\n          kind\n\n          ofType {\n            kind\n\n            name\n            ofType {\n              kind\n              name\n\n              ofType {\n                kind\n                name\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n",{},!0,e)];case 1:return t=o.sent(),this.schema=new w(t.data.__schema),this.logger.log("GraphQL Schema successful fetched",t),this.logger.log("Starting to process the schema ..."),this.processSchema(),this.logger.log("Schema procession done!"),n(this.schema),[2]}})})})),[2,this.schemaWillBeLoaded]})})},e.prototype.loadSchemaSync=function(e){this.logger.log("loadSchemaSync"),this.options.connectionQueryMode?this.connectionQueryMode=this.options.connectionQueryMode:this.connectionQueryMode="auto",this.schema=new w(e.data.__schema),this.logger.log("GraphQL Schema successful fetched",e),this.logger.log("Starting to process the schema ..."),this.processSchema(),this.logger.log("Schema procession done!"),this.schemaWillBeLoaded=Promise.resolve(this.schema)},e.prototype.processSchema=function(){var e=this;this.models.forEach(function(n){var t;try{t=e.schema.getType(n.singularName)}catch(t){return void e.logger.warn("Ignoring entity "+n.singularName+" because it's not in the schema.")}n.fields.forEach(function(o,r){t.fields.find(function(e){return e.name===r})||(e.logger.warn("Ignoring field "+n.singularName+"."+r+" because it's not in the schema."),n.baseModel.skipFields=n.baseModel.skipFields?n.baseModel.skipFields:[],n.baseModel.skipFields.includes(r)||n.baseModel.skipFields.push(r))})}),"auto"===this.connectionQueryMode?(this.connectionQueryMode=this.schema.determineQueryMode(),this.logger.log("Connection Query Mode is "+this.connectionQueryMode+" by automatic detection")):this.logger.log("Connection Query Mode is "+this.connectionQueryMode+" by config")},e.prototype.getModel=function(e,n){if(void 0===n&&(n=!1),"string"==typeof e){var t=c(d(e));if(e=this.models.get(t),!n&&!e)throw new Error("No such model "+t+"!")}return e},e.prototype.collectModels=function(){var e=this;this.database.entities.forEach(function(n){var t=new y(n.model);e.models.set(t.singularName,t),y.augment(t)})},e}(),M=function(){function e(){}return e.buildField=function(e,n,t,o,r,i,s){void 0===n&&(n=!0),void 0===o&&(o=[]),void 0===i&&(i=!1),void 0===s&&(s=!1);var a=$.getInstance();e=a.getModel(e),r=r||e.pluralName;var u=a.schema.getMutation(r,!0)||a.schema.getQuery(r,!0),c=this.buildArguments(e,t,!1,i,s,u);o=0===o.length?[e.singularName]:o;var l="\n      "+e.getQueryFields().join(" ")+"\n      "+this.buildRelationsQuery(e,o)+"\n    ";if(n){var d=""+r+c;return"nodes"===a.connectionQueryMode?"\n          "+d+" {\n            nodes {\n              "+l+"\n            }\n          }\n        ":"edges"===a.connectionQueryMode?"\n          "+d+" {\n            edges {\n              node {\n                "+l+"\n              }\n            }\n          }\n        ":"\n          "+d+" {\n            "+l+"\n          }\n        "}return"\n        "+(r||e.singularName)+c+" {\n          "+l+"\n        }\n      "},e.buildQuery=function(e,n,o,r,i,s){var a=$.getInstance();n=a.getModel(n),r=r?t({},r):{},Object.keys(r).forEach(function(e){r&&r[e]&&m(r[e])&&(r[e]={__type:l(e)})}),i=void 0===i?!r.id:i,o||(o=i?n.pluralName:n.singularName);var u=a.schema.getMutation(o,!0)||a.schema.getQuery(o,!0);return e+" "+l(o)+this.buildArguments(n,r,!0,s,!0,u)+" {\n  "+this.buildField(n,i,r,[],o,s,!0)+"\n}"},e.buildArguments=function(n,t,o,r,i,s){var a=this;if(void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===i&&(i=!0),void 0===s&&(s=null),void 0===t)return"";var u="",c=!0;return t&&(Object.keys(t).forEach(function(l){var d=t[l],h=n.skipField(l),f=("id"===l||h)&&!i,p=a.findSchemaFieldForArgument(l,s,n,r),g=p&&w.getTypeNameOfField(p).endsWith("TypeConnection");if(d&&!f&&!g){var y="";if(o)if(m(d)&&d.__type)y=d.__type+"Input!";else if(Array.isArray(d)&&s){var v=e.findSchemaFieldForArgument(l,s,n,r);if(!v)throw new Error("The argument "+l+" is of type array but it's not possible to determine the type, because it's not in the field "+s.name);y=w.getTypeNameOfField(v)+"!"}else p&&w.getTypeNameOfField(p)?y=w.getTypeNameOfField(p)+"!":"id"===l||h?y="ID!":(y=a.determineAttributeType(n,l,d,s||void 0),y+="!");else y="$"+l;u=u+(c?"":", ")+(o?"$":"")+l+": "+y,c=!1}}),c||(!o&&r&&(u="filter: { "+u+" }"),u="("+u+")")),u},e.determineAttributeType=function(e,n,t,o){var r,i=$.getInstance(),s=e.fields.get(n);o?(r=o.args.find(function(e){return e.name===n}))||o.args.find(function(e){return"filter"===e.name})&&(r=this.findSchemaFieldForArgument(n,null,e,!0)):r=i.schema.getType(e.singularName).fields.find(function(e){return e.name===n});if(r&&w.getTypeNameOfField(r))return w.getTypeNameOfField(r);if(s instanceof i.components.String)return"String";if(s&&s instanceof i.components.Number)return"Int";if(s&&s instanceof i.components.Boolean)return"Boolean";if("number"==typeof t)return"Int";if("string"==typeof t)return"String";if("boolean"==typeof t)return"Boolean";throw new Error("Can't find suitable graphql type for field '"+e.singularName+"."+n+"'.")},e.findSchemaFieldForArgument=function(e,n,t,o){var r,i=$.getInstance().schema;if(n&&(r=n.args.find(function(n){return n.name===e})))return r;var s=i.getType(t.singularName+(o?"Filter":""),!0);return(r=s?(o?s.inputFields:s.fields).find(function(n){return n.name===e}):void 0)||$.getInstance().logger.warn("Couldn't find the argument with name "+e+" for the mutation/query "+(n?n.name:"(?)")),r},e.buildRelationsQuery=function(e,n){var t=this;if(void 0===n&&(n=[]),null===e)return"";var o=$.getInstance(),r=[];return e.getRelations().forEach(function(i,s){var a,u=i;u instanceof o.components.BelongsToMany||u instanceof o.components.HasMany||u instanceof o.components.HasManyThrough||u instanceof o.components.MorphedByMany||u instanceof o.components.MorphMany||u instanceof o.components.MorphOne||u instanceof o.components.MorphToMany||u instanceof o.components.HasOne?a=o.getModel(u.related.entity):u instanceof o.components.BelongsTo||u instanceof o.components.HasManyBy?a=o.getModel(u.parent.entity):u instanceof o.components.MorphTo?a=o.getModel(u.type):(a=o.getModel(s),o.logger.log("WARNING: unknown field type. Fallback to attribute name",u));var c=function(e,n){for(var t=-1;++t<e.length&&n(e[t],t,e););return e.slice(0,t)}(n.slice(0).reverse(),function(e){return e===a.singularName}).length,l=c?c>5:n.includes(a.singularName);if(e.shouldEagerLoadRelation(s,i,a)&&!l){var d=n.slice(0);d.push(a.singularName),r.push(t.buildField(a,y.isConnection(i),void 0,d,s,!1))}}),r.join("\n")},e}(),F=function(){function e(){}return e.insertData=function(e,n){return o(this,void 0,void 0,function(){var t,i=this;return r(this,function(s){switch(s.label){case 0:return t={},[4,Promise.all(Object.keys(e).map(function(s){return o(i,void 0,void 0,function(){var o,i;return r(this,function(r){switch(r.label){case 0:return o=e[s],$.getInstance().logger.log("Inserting records",o),[4,n("insertOrUpdate",{data:o})];case 1:return i=r.sent(),Object.keys(i).forEach(function(e){t[e]||(t[e]=[]),t[e]=t[e].concat(i[e])}),[2]}})})}))];case 1:return s.sent(),[2,t]}})})},e}(),T=function(){function e(){}return e.getNameForPersist=function(e){return this.getCRUDName("create",e)},e.getNameForPush=function(e){return this.getCRUDName("update",e)},e.getNameForDestroy=function(e){return this.getCRUDName("delete",e)},e.getNameForFetch=function(e,n){return void 0===n&&(n=!1),n?e.pluralName:e.singularName},e.getCRUDName=function(e,n){return""+e+l(n.singularName)},e}(),I=function(){function e(){}return e.mutation=function(e,n,t,i){return o(this,void 0,void 0,function(){var o,s,a,u,c,l,d,h,f,p;return r(this,function(r){switch(r.label){case 0:return n?(s=$.getInstance(),(u=s.schema)?[3,2]:[4,s.loadSchema()]):[3,6];case 1:u=r.sent(),r.label=2;case 2:return a=u,c=w.returnsConnection(a.getMutation(e)),l=M.buildQuery("mutation",i,e,n,c),[4,$.getInstance().apollo.request(i,l,n,!0)];case 3:return d=r.sent(),e===T.getNameForDestroy(i)?[3,5]:((d=d[Object.keys(d)[0]]).id=parseInt(d.id,10),[4,F.insertData((o={},o[i.pluralName]=d,o),t)]);case 4:return h=r.sent(),f=h[i.pluralName],(p=f[f.length-1])?[2,p]:($.getInstance().logger.log("Couldn't find the record of type '",i.pluralName,"' within",h,". Falling back to find()"),[2,i.baseModel.query().last()]);case 5:return[2,!0];case 6:return[2]}})})},e.getModelFromState=function(e){return $.getInstance().getModel(e.$name)},e.prepareArgs=function(e,n){return e=e||{},n&&(e.id=n),e},e.addRecordToArgs=function(e,n,t){return e[n.singularName]=v.transformOutgoingData(n,t),e},e.transformArgs=function(e){var n=$.getInstance();return Object.keys(e).forEach(function(t){var o=e[t];if(o instanceof n.components.Model){var r=n.getModel(c(o.$self().entity)),i=v.transformOutgoingData(r,o);n.logger.log("A",t,"model was found within the variables and will be transformed from",o,"to",i),e[t]=i}}),e},e}(),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch,s=n.id,a=n.args;return o(this,void 0,void 0,function(){var e,n;return r(this,function(o){switch(o.label){case 0:return s?(e=this.getModelFromState(t),n=T.getNameForDestroy(e),a=this.prepareArgs(a,s),[4,I.mutation(n,a,i,e)]):[3,2];case 1:return o.sent(),[2,!0];case 2:throw new Error("The destroy action requires the 'id' to be set")}})})},t}(I),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch;return o(this,void 0,void 0,function(){var e,o,s,a,u,c,l,d;return r(this,function(r){switch(r.label){case 0:return e=$.getInstance(),o=this.getModelFromState(t),e.schema?[3,2]:[4,e.loadSchema()];case 1:r.sent(),r.label=2;case 2:return s=n&&n.filter?v.transformOutgoingData(o,n.filter,Object.keys(n.filter)):{},a=n&&n.bypassCache,u=!s.id,c=T.getNameForFetch(o,u),n&&n.beforeBuildQuery&&n.beforeBuildQuery(),l=M.buildQuery("query",o,c,s,u,u),n&&n.afterBuildQuery&&n.afterBuildQuery(),[4,e.apollo.request(o,l,s,!1,a)];case 3:return d=r.sent(),[2,F.insertData(d,i)]}})})},t}(I),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch,s=n.args,a=n.name;return o(this,void 0,void 0,function(){var e,n;return r(this,function(o){switch(o.label){case 0:return a?(e=$.getInstance(),n=this.getModelFromState(t),e.schema?[3,2]:[4,e.loadSchema()]):[3,3];case 1:o.sent(),o.label=2;case 2:return s=this.prepareArgs(s),this.transformArgs(s),[2,I.mutation(a,s,i,n)];case 3:throw new Error("The mutate action requires the mutation name ('mutation') to be set")}})})},t}(I),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch,s=n.id,a=n.args;return o(this,void 0,void 0,function(){var e,n,o,u;return r(this,function(r){switch(r.label){case 0:return s?(e=this.getModelFromState(t),n=T.getNameForPersist(e),o=e.getRecordWithId(s),a=this.prepareArgs(a),this.addRecordToArgs(a,e,o),[4,I.mutation(n,a,i,e)]):[3,3];case 1:return u=r.sent(),[4,this.deleteObsoleteRecord(e,u,o)];case 2:return r.sent(),[2,u];case 3:throw new Error("The persist action requires the 'id' to be set")}})})},t.deleteObsoleteRecord=function(e,n,t){return o(this,void 0,void 0,function(){return r(this,function(e){return n&&t&&n.id!==t.id?($.getInstance().logger.log("Dropping deprecated record",t),[2,t.$delete()]):[2]})})},t}(I),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch,s=n.data,a=n.args;return o(this,void 0,void 0,function(){var e,n;return r(this,function(o){if(s)return e=this.getModelFromState(t),n=T.getNameForPush(e),a=this.prepareArgs(a,s.id),this.addRecordToArgs(a,e,s),[2,I.mutation(n,a,i,e)];throw new Error("The persist action requires the 'data' to be set")})})},t}(I),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){var t=e.state,i=e.dispatch,s=n.name,a=n.filter,u=n.bypassCache;return o(this,void 0,void 0,function(){var e,n,o,c,l,d,h;return r(this,function(r){switch(r.label){case 0:return s?(e=$.getInstance(),n=this.getModelFromState(t),(c=e.schema)?[3,2]:[4,e.loadSchema()]):[3,4];case 1:c=r.sent(),r.label=2;case 2:return o=c,a=a?v.transformOutgoingData(n,a):{},l=w.returnsConnection(o.getQuery(s)),d=M.buildQuery("query",n,s,a,l,!1),[4,e.apollo.request(n,d,a,!1,u)];case 3:return h=r.sent(),[2,F.insertData(h,i)];case 4:throw new Error("The customQuery action requires the query name ('name') to be set")}})})},t}(I),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){e.dispatch;var t=n.query,i=n.bypassCache,s=n.variables;return o(this,void 0,void 0,function(){var e,n,o;return r(this,function(r){switch(r.label){case 0:return e=$.getInstance(),t?(n=f(t),s=this.prepareArgs(s),[4,e.apollo.simpleQuery(p(n),s,i)]):[3,2];case 1:return o=r.sent(),[2,(a=o.data,JSON.parse(JSON.stringify(a)))];case 2:throw new Error("The simpleQuery action requires the 'query' to be set")}var a})})},t}(I),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.call=function(e,n){e.dispatch;var t=n.query,i=n.variables;return o(this,void 0,void 0,function(){var e,n;return r(this,function(o){switch(o.label){case 0:return e=$.getInstance(),t?(n=f(t),i=this.prepareArgs(i),[4,e.apollo.simpleMutation(p(n),i)]):[3,2];case 1:return[2,o.sent().data];case 2:throw new Error("The simpleMutation action requires the 'query' to be set")}})})},t}(I),R=function(){function e(n,t){$.setup(n,t),e.setupActions(),e.setupModelMethods()}return e.prototype.getContext=function(){return $.getInstance()},e.setupActions=function(){var e=$.getInstance();e.components.RootActions.simpleQuery=S.call.bind(S),e.components.RootActions.simpleMutation=A.call.bind(A),e.components.Actions.fetch=N.call.bind(N),e.components.Actions.persist=O.call.bind(O),e.components.Actions.push=E.call.bind(E),e.components.Actions.destroy=k.call.bind(k),e.components.Actions.mutate=Q.call.bind(Q),e.components.Actions.query=C.call.bind(C)},e.setupModelMethods=function(){var e=$.getInstance();e.components.Model.fetch=function(e,n){return void 0===n&&(n=!1),o(this,void 0,void 0,function(){var t;return r(this,function(o){return m(t=e)||(t={id:e}),[2,this.dispatch("fetch",{filter:t,bypassCache:n})]})})},e.components.Model.mutate=function(e){return o(this,void 0,void 0,function(){return r(this,function(n){return[2,this.dispatch("mutate",e)]})})},e.components.Model.customQuery=function(e){var n=e.name,t=e.filter,i=e.multiple,s=e.bypassCache;return o(this,void 0,void 0,function(){return r(this,function(e){return[2,this.dispatch("query",{name:n,filter:t,multiple:i,bypassCache:s})]})})};var n=e.components.Model.prototype;n.$mutate=function(e){var n=e.name,t=e.args,i=e.multiple;return o(this,void 0,void 0,function(){return r(this,function(e){return(t=t||{}).id||(t.id=this.id),[2,this.$dispatch("mutate",{name:n,args:t,multiple:i})]})})},n.$customQuery=function(e){var n=e.name,t=e.filter,i=e.multiple,s=e.bypassCache;return o(this,void 0,void 0,function(){return r(this,function(e){return(t=t||{}).id||(t.id=this.id),[2,this.$dispatch("query",{name:n,filter:t,multiple:i,bypassCache:s})]})})},n.$persist=function(e){return o(this,void 0,void 0,function(){return r(this,function(n){return[2,this.$dispatch("persist",{id:this.id,args:e})]})})},n.$push=function(e){return o(this,void 0,void 0,function(){return r(this,function(n){return[2,this.$dispatch("push",{data:this,args:e})]})})},n.$destroy=function(){return o(this,void 0,void 0,function(){return r(this,function(e){return[2,this.$dispatch("destroy",{id:this.id})]})})},n.$deleteAndDestroy=function(){return o(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.$delete()];case 1:return e.sent(),[2,this.$destroy()]}})})}},e}();return function(){function e(){}return e.install=function(n,t){return e.instance=new R(n,t),e.instance},e}()});
//# sourceMappingURL=vuex-orm-graphql.umd.js.map
